	.ORIG x3000

	LD R0,INPUT

LOOP1	AND R2,R2,#0
	AND R3,R3,#0
 	ADD R2,R2,#5
	LDR R1,R0,#0
	BRz END
	BRp RIGHT1
NEG1	ADD R3,R3,#1
RIGHT1 	ADD R3,R3,#0
 	ADD R2,R2,#-1
	BRz NXT1
	ADD R3,R3,R3
	ADD R1,R1,R1
	BRn NEG1
	BRzP RIGHT1
;-------------------------
NXT1	ST R3,START

	AND R3,R3,#0
	ADD R2,R2,#5
	ADD R1,R1,R1
		
	BRzP RIGHT2
NEG2	ADD R3,R3,#1
RIGHT2 	
	ADD R2,R2,#-1
	BRz NXT2
	ADD R3,R3,R3
	ADD R1,R1,R1
	BRn NEG2
	BRzp RIGHT2
;-------------------------------
NXT2	ST R3,ENDTIME

	AND R3,R3,#0
	ADD R2,R2,#6
	ADD R1,R1,R1
	BRzP RIGHT3
NEG3	ADD R3,R3,#1
RIGHT3 	ADD R2,R2,#-1
	BRz LAST
	ADD R3,R3,R3
	ADD R1,R1,R1
	BRn NEG3
	BRzp RIGHT3

LAST	ST R3,ID
;--------------------------------
			;LOOP2		

	LD R4,START
	LD R6,ENDTIME
	NOT R4,R4
	ADD R4,R4,#1
	ADD R6,R4,R6	;R6: THE NUMBER OF HRS REQUESTED FROM THE START TIME
	ST R6,HRS

	LD R4,START
	LD R2,SCHED
	ADD R4,R4,R2	;R4: THE STARTING TIME TO CHECK
	ST R4,REQTIME
	
	ADD R0,R0,#1
COUNT	ADD R6,R6,#0
	BRz LOOP3	;IF R6 IS ZERO THEN 
	LD R2,ID
	LDR R1,R4,#0	;R1: ID OF THE PERSON WHO ALREADY CHECKED OUT THE TIME SLOT
	BRz BACK	;IF R1 IS 0 OR NOBODY CHECKED OUT YET	 
	NOT R2,R2	
	ADD R2,R2,#1		
	
SUBT	ADD R3,R1,R2	;SUBTRACT THE TWO IDs (R1,R2) TO SEE IF IT'S THE SAME PERSON
DENY	BRnp LOOP1	;IF IT'S NOT THE SAME PERSON THE REQUEST DENIED. GO FOR THE NEXT REQUEST

BACK	ADD R4,R4,#1	;GO TO THE NEXT HOUR TIME SLOT
	ADD R6,R6,#-1	;R6 IS THE COUNTER OF THE HRS FROM THE START TIME
	BRz LOOP3
	BRp COUNT

;--------------------------
			;LOOP3

LOOP3	LD R6,HRS
	LD R5,REQTIME
	LD R2,ID
MODIFY	STR R2,R5,#0
	ADD R5,R5,#1
	ADD R6,R6,#-1
	BRz LOOP1
	BRp MODIFY

END	HALT

SCHED	.FILL x3100
INPUT	.FILL x3200
ID	.FILL x003F
ENDTIME	.FILL x07C0
START	.FILL xF800
HRS	.FILL x0000
REQTIME	.FILL x0000
	.END
